<div class="header bg-gradient-cus pb-8 pt-5 pt-md-8">
  <div class="container-fluid">
    <div class="header-body">
      <!-- Card stats -->
      <div class="row">
        <div class="col-xl-3 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">Traffic</h5>
                  <span class="h2 font-weight-bold mb-0">350,897</span>
                </div>
                <div class="col-auto">
                  <div class="icon icon-shape bg-danger text-white rounded-circle shadow">
                    <i class="fas fa-chart-bar"></i>
                  </div>
                </div>
              </div>
              <p class="mt-3 mb-0 text-muted text-sm">
                <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span>
                <span class="text-nowrap">Since last month</span>
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">New users</h5>
                  <span class="h2 font-weight-bold mb-0">2,356</span>
                </div>
                <div class="col-auto">
                  <div class="icon icon-shape bg-warning text-white rounded-circle shadow">
                    <i class="fas fa-chart-pie"></i>
                  </div>
                </div>
              </div>
              <p class="mt-3 mb-0 text-muted text-sm">
                <span class="text-danger mr-2"><i class="fas fa-arrow-down"></i> 3.48%</span>
                <span class="text-nowrap">Since last week</span>
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">Sales</h5>
                  <span class="h2 font-weight-bold mb-0">924</span>
                </div>
                <div class="col-auto">
                  <div class="icon icon-shape bg-yellow text-white rounded-circle shadow">
                    <i class="fas fa-users"></i>
                  </div>
                </div>
              </div>
              <p class="mt-3 mb-0 text-muted text-sm">
                <span class="text-warning mr-2"><i class="fas fa-arrow-down"></i> 1.10%</span>
                <span class="text-nowrap">Since yesterday</span>
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">Performance</h5>
                  <span class="h2 font-weight-bold mb-0">49,65%</span>
                </div>
                <div class="col-auto">
                  <div class="icon icon-shape bg-info text-white rounded-circle shadow">
                    <i class="fas fa-percent"></i>
                  </div>
                </div>
              </div>
              <p class="mt-3 mb-0 text-muted text-sm">
                <span class="text-success mr-2"><i class="fas fa-arrow-up"></i> 12%</span>
                <span class="text-nowrap">Since last month</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<nav ngbNav #nav="ngbNav" class="nav-pills" style="position: relative;
top: -62px;
z-index: 1;
left: 35%;
width: fit-content;">
	<ng-container ngbNavItem>
		<a ngbNavLink class="titleBN" style="font-size: 25px;">Thông tin chi tiết</a>
    <ng-template ngbNavContent>
      <nav ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-pills" style="margin-top: 7rem; margin-left: 11rem; position: absolute; z-index: 1;">
        <ng-container [ngbNavItem]="1">
          <a ngbNavLink class="titleBN" style="font-size: 17px;" >Thông tin</a>
          <ng-template ngbNavContent>
            <div class="containerBN" *ngIf="resTour" style="margin-top: -10%; margin-bottom: 10%;">
              <div class="bannerBN">
                  <div class="titleBN" style="background-image: url({{img}});">
                  </div>
                  <div class="detailBN row">
                     <div class="infoBN col-3">
                       <h2>{{resTour.nameTour}}</h2>
                       <div class="desBN">
                        <i class="fa-solid fa-star text-yellow" *ngFor='let star of resTour.rating | forNumber'></i>
                        <i class="fa-solid fa-star" *ngFor='let star of (listStar.length - 1) - resTour.rating | forNumber'></i>
                       </div>
                     </div>
                     <div class="col-5">
                      <img style="width: 100% ;height: 380px; border-radius: 20px;" [src]="img">
                     </div>
                    <div class="optionBN col-4">
                      <fieldset style="margin-top: -10%; height: 103%;">
                        <legend>Chi tiết Tour</legend>
                        <div class="row">
                          <div class="form-group">
                            <label class="form-control-label" for="input-tourName">Tên Chuyến Du Lịch
                              <span [class]="this.type != 'create' &&resTour.isDelete || isLoading ?'d-none':'text-red'">* {{this.validateTourModel.nameTour ? this.validateTourModel.nameTour : ''}}</span>
                            </label>
                            <input type="text" id="nameTour" name="nameTour" (input)="inputChange()" class="form-control form-control-alternative" placeholder="Nhập số tên chuyến du lịch" [(ngModel)]="resTour.nameTour" [readonly]="type == 'refuse' || type == 'cancelRequire' || type == 'approve' ||resTour.isDelete || isLoading" >
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <div class="form-group">
                            <label class="form-control-label" for="input-toPlace">Điểm đến
                              <span [class]="this.type != 'create' &&resTour.isDelete || isLoading ?'d-none':'text-red'">* {{this.validateTourModel.toPlace ? this.validateTourModel.toPlace : ''}}</span>
                             </label>
                             <ng-select
                            [items]="resProvince"
                            [(ngModel)]="resTour.toPlace"
                            [disabled]="type == 'refuse' || type == 'cancelRequire' || type == 'approve' ||resTour.isDelete || isLoading"
                            placeholder="Chọn điểm đến"
                            name="toPlace"
                            id="toPlace"
                            bindLabel="nameProvince"
                            bindValue="nameProvince"
                            [searchable]="false"
                            [clearable]="false"
                            (change)="inputChange()">
                          </ng-select>
                           </div>
                          </div>
                        </div>

                        <div class="row" *ngIf="this.type == 'detail' && !resTour.isDelete ">
                          <div [class]="isChange && type == 'detail' && resAuth.roleId == -1 ? 'col-8': 'col'">
                            <label class="form-control-label" for="input-tourName">Đánh giá</label>
                            <ng-select
                            [items]="listStar"
                            [(ngModel)]="resTour.rating"
                            [disabled]="type == 'refuse' || type == 'cancelRequire' || type == 'approve' ||resTour.isDelete || isLoading || resAuth.roleId != -1"
                            placeholder="Chọn số sao..."
                            name="star"
                            id="rating"
                            bindLabel="name"
                            bindValue="id"
                            [searchable]="false"
                            [clearable]="false"
                            (change)="startChange()">

                            <ng-template ng-label-tmp let-item="item" let-item$="item$" let-index="index">
                              {{item.name}} -
                              <i class="fa-solid fa-star text-yellow" *ngFor='let star of resTour.rating | forNumber'></i>
                              <i class="fa-solid fa-star" *ngFor='let star of listStar.length-1 - resTour.rating | forNumber'></i>
                            </ng-template>

                            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                              {{item.name}} -
                              <i class="fa-solid fa-star text-yellow" *ngFor='let star of item.id | forNumber'></i>
                              <i class="fa-solid fa-star" *ngFor='let star of listStar.length-1 - item.id  | forNumber'></i>
                            </ng-template>
                          </ng-select>
                          </div>
                          <div class="col-4" style="position: relative;top: 37px;"  *ngIf="isChangeStar && resAuth.roleId == -1">
                            <button  *ngIf="!isLoading"  class="btn  btn-sm btn-success"(click)="ratingTour()" >Cập nhật sao</button>
                          </div>
                        </div>


                        <!-- <span [class]="this.type != 'create' && resTour.isDelete ?'d-none':'text-red'">{{this.validateTourModel.thumbnail ? this.validateTourModel.thumbnail : ''}}</span> -->
                        <div class="align-items-center text-right mt-2" style="margin-right: 1rem;">
                          <ng-container *ngIf="type != 'approve' && type != 'refuse' && type != 'cancelRequire'; else elseApprove">
                            <ng-container *ngIf="!isLoading">
                              <input id="file" type="file" class="d-none" accept="image/*,.jpg, .png, .jpeg" (change)="changeImg($event); inputChange()" [disabled]="isLoading">
                              <label *ngIf="type == 'create'|| type == 'detail'  && !resTour.isDelete" for="file" style="margin-top: 10px;"  class="btn btn-sm btn-primary">Chọn Hình</label>
                            </ng-container>

                            <button  *ngIf="type == 'detail' && !resTour.isDelete" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteItemTourModal" [disabled]="isLoading">Xóa</button>
                            <button *ngIf="isChangeStar || isChange && !isLoading" class="btn btn-sm btn-info" (click)="backup()" [disabled]="isLoading">Khôi phục</button>
                            <button *ngIf="isChange" class="btn btn-sm btn-success"   (click)="isLoading=true;save()" [disabled]="isLoading">{{isLoading?'Đang xử lý...':type == 'detail' ? "Cập nhật":"Thêm"}}</button>
                            <button *ngIf="resTour.isDelete"  data-bs-toggle="modal" data-bs-target="#restoreItemTourModal" class="btn btn-sm btn-warning" [disabled]="isLoading">Khôi phục tour</button>

                     </ng-container>
                     <ng-template #elseApprove>
                      <div class="row mt-4" style="border-top: 1.5px solid; padding-top: 20px;">
                        <div [class]="resAuth.roleId == -1 && resAuth.id == resTour.idUserModify ? 'col-4' : 'col-6'"
                        [style]="resAuth.roleId == -1 && resAuth.id == resTour.idUserModify ? 'text-align: end' : 'padding-left: 8%; text-align: center'"
                        *ngIf="resAuth.roleId == -1">
                          <button class="btn btn-sm btn-success"  data-bs-toggle="modal" data-bs-target="#approveItemTourModal" [disabled]="isLoading">Phê duyệt</button>
                        </div>
                        <div [class]="resAuth.roleId == -1 && resAuth.id == resTour.idUserModify ? 'col-4' : 'col-6'"
                         style="text-align: center" *ngIf="resAuth.roleId == -1">
                          <button class="btn btn-sm  btn-warning"  data-bs-toggle="modal" data-bs-target="#refusedItemTourModal" [disabled]="isLoading">Từ chối phê duyệt</button>
                        </div>
                        <div [class]="resAuth.roleId != -1 && resAuth.id == resTour.idUserModify ? 'col' : 'col-4'"
                        [style]="resAuth.roleId != -1 && resAuth.id == resTour.idUserModify ? 'padding-right: 4.9%; text-align: end' : ''"
                        *ngIf="resAuth.id == resTour.idUserModify">
                          <button class="btn btn-sm  btn-danger" data-bs-toggle="modal" data-bs-target="#deleteItemTourModal" [disabled]="isLoading">Hủy yêu cầu phê duyệt</button>
                        </div>
                      </div>
                     </ng-template>
                       </div>

                      </fieldset>
                     <!-- Lorem ipsum dolor sit amet consectetur adipisicing elit.
                         Magni vitae labore aliquid sequi sunt harum!
                         <br>
                         <b>Màu sắc</b> <br>
                         <div class="ellipseBN" style="background-color:#555"></div>
                         <div class="ellipseBN" style="background-color:aqua"></div>
                         <div class="ellipseBN" style="background-color:brown"></div>
                         <br>
                         <button class="cardBN">Add to card</button> -->
                    </div>
                  </div>
              </div>
            </div>
          </ng-template>
        </ng-container>
        <ng-container [ngbNavItem]="2">
          <a ngbNavLink class="titleBN" style="font-size: 17px;">Hình ảnh chi tiết</a>
          <ng-template ngbNavContent>
            <div class="containerBN" *ngIf="resTour" style="margin-top: -10%; margin-bottom: 10%;">
              <div class="bannerBN">
                  <div class="titleBN" style="background-image: url({{img}});">
                  </div>
                  <div class="detailBN row">
                    <div class="optionBN col-4">
                      <fieldset style="margin-top: -12.5%; height: 111%;">
                        <legend>Chi tiết Tour</legend>

                        <ng-container *ngIf="resImage.length < 4">
                          <input #tourImg id="files" type="file" multiple class="d-none" accept="image/*,.jpg, .png, .jpeg" (change)="changeTourImg($event); inputChange()">
                         <button for="files"  class="icon-btn add-btn" (click)="btnTourImg()" style="position: relative;top: -5%;" [disabled]="isLoading" *ngIf="type == 'create'|| type == 'detail'  && !resTour.isDelete">
                           <div class="add-icon"></div>
                          <div class="btn-txt">Thêm hình</div>
                          </button>
                        </ng-container>


                        <div class="row">


                          <div class="form-group" style="margin-top: -15px;">
                            <!-- <ng-container *ngIf="formDatas && type=='create'; else imageDetail">
                              <div class="row"  *ngFor="let file of formDatas.path[0].files; let i=index">
                                <div class="col-9">
                                  <label class="form-control-label" for="input-tourName">Tấm {{i+1}}</label>
                                  <input type="text" [(ngModel)]="file.name" [name]="i" class="form-control form-control-alternative" readonly >

                                </div>
                                <div class="col-3">
                                  <div class="btn btn-outline-danger" (click)="btnDeleteImg(i, file)" style="margin-top: 40%;">
                                    Xóa
                                  </div>
                                </div>
                              </div>
                            </ng-container>
                            <ng-template #imageDetail>
                              <div class="row"  *ngFor="let file of resImage; let i=index">
                                <div class="col-9">
                                  <label class="form-control-label" for="input-tourName">Tấm {{i+1}}</label>
                                  <input type="text" [(ngModel)]="file.nameImage"  class="form-control form-control-alternative" readonly >

                                </div>
                                <div class="col-3">
                                  <div class="btn btn-outline-danger" (click)="btnDeleteImg(i, file)" style="margin-top: 40%;">
                                    Xóa
                                  </div>
                                </div>
                              </div>
                            </ng-template> -->

                            <div class="row"  *ngFor="let file of resImage; let i=index">
                              <div class="col-9">
                                <label class="form-control-label" for="input-tourName">Tấm {{i+1}}</label>
                                <input type="text" [(ngModel)]="file.nameImage"  class="form-control form-control-alternative" readonly >

                              </div>
                              <div class="col-3">
                                <ng-container *ngIf="!isLoading">
                                  <button class="btn btn-outline-danger" (click)="btnDeleteImg(i, file)" style="margin-top: 40%;" *ngIf="type == 'create'|| type == 'detail'  && !resTour.isDelete">
                                    Xóa
                                  </button>
                                </ng-container>
                              </div>
                              <hr style="margin-bottom: 0rem;">
                            </div>
                         </div>
                        </div>
                      </fieldset>
                    </div>

                     <div class="optionBN col-8">
                      <fieldset style="margin-top: -6%;height: 112%;">
                        <legend>Hình chi tiết tour</legend>
                        <div class="row">
                          <div class="col-12">

                            <div class="row">
                              <div class="col">
                                <div class="row mb-2">
                                  <div class="col-6">
                                    <img [src]="imgDetail[0]" id="imgDetail[0]" class="img-fluid"
                                      style="float: right; border-radius:10px; object-fit:fill; width: 19rem;height: 12rem;" alt="">
                                  </div>
                                  <div class="col-6">
                                    <img [src]="imgDetail[1]" class="img-fluid"
                                      style="float: left; border-radius:10px; object-fit:fill; width: 19rem;height: 12rem;" alt="">
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="row">
                              <div class="col">
                                <div class="row mb-2">
                                  <div class="col-6">
                                    <img [src]="imgDetail[2]" class="img-fluid"
                                      style="float: right; border-radius:10px; object-fit:fill; width: 19rem;height: 12rem;" alt="">
                                  </div>
                                  <div class="col-6">
                                    <img [src]="imgDetail[3]" class="img-fluid"
                                      style="float: left; border-radius:10px; object-fit:fill; width: 19rem;height: 12rem;" alt="">
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </fieldset>

                     </div>

                  </div>
              </div>
            </div>
          </ng-template>
        </ng-container>
      </nav>

      <div [ngbNavOutlet]="nav" class="mt-2"></div>

    </ng-template>
	</ng-container>
	<ng-container *ngIf="type == 'detail'" ngbNavItem>
		<a ngbNavLink style="font-size: 25px;" class="titleBN">Lịch trình</a>
    <ng-template ngbNavContent>
      <app-view-tour-schedule></app-view-tour-schedule>
    </ng-template>
	</ng-container>
</nav>
<div [ngbNavOutlet]="nav" class="mt-2"></div>





<div class="modal fade" id="deleteItemTourModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="deleteItemTourModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteItemTourModal">Xác nhận</h1>
        <button type="button" #closeModalLoadDelete class="btn-close" data-bs-dismiss="modal" aria-label="Close" [disabled]="isLoading"></button>
      </div>
      <div class="modal-body" *ngIf="resTour">
        Bạn có chắc muốn {{!resTour.typeAction ? "Xóa":"Hủy yêu cầu"}} [<span class="text-red">{{resTour.nameTour}}</span>] !
      </div>
      <div class="modal-footer" *ngIf="resTour">
        <button type="button" class="btn btn-danger" (click)="isLoading=true;delete()" [disabled]="isLoading">
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          {{isLoading?'Đang xử lý...':!resTour.typeAction ? "Xóa":"Hủy yêu cầu"}}
        </button>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" [disabled]="isLoading">Không</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="restoreItemTourModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="restoreItemTourModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="restoreItemTourModal">Xác nhận</h1>
        <button type="button" #closeModalLoadRestore class="btn-close" data-bs-dismiss="modal" aria-label="Close" [disabled]="isLoading"></button>
      </div>
      <div class="modal-body" *ngIf="resTour">
        Bạn có chắc muốn khôi phục [<span class="text-red">{{resTour.nameTour}}</span>] !
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="isLoading=true;restoreTour()" [disabled]="isLoading">
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          {{isLoading?'Đang xử lý...':'Khôi phục'}}
        </button>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" [disabled]="isLoading">Không</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="approveItemTourModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="approveItemTourModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="approveItemTourModal">Xác nhận</h1>
        <button type="button" #closeModalLoadApprove class="btn-close" data-bs-dismiss="modal" aria-label="Close" [disabled]="isLoading"></button>
      </div>
      <div class="modal-body" *ngIf="resTour">
        Bạn có chắc muốn phê duyệt [<span class="text-red">{{resTour.nameTour}}</span>] !
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-bs-dismiss="modal" (click)="isLoading=true;approve()" [disabled]="isLoading">{{isLoading?'Đang xử lý...':'Phê duyệt'}}</button>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" [disabled]="isLoading">Không</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="refusedItemTourModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="refusedItemTourModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="refusedItemTourModal">Xác nhận</h1>
        <button type="button" #closeModalLoadRefused class="btn-close" data-bs-dismiss="modal" aria-label="Close" [disabled]="isLoading"></button>
      </div>
      <div class="modal-body" *ngIf="resTour">
        Bạn có chắc muốn từ chối phê duyệt [<span class="text-red">{{resTour.nameTour}}</span>] !
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal" (click)="refused()">{{isLoading?'Đang xử lý...':'Từ chối'}}</button>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" [disabled]="isLoading">Không</button>
      </div>
    </div>
  </div>
</div>
